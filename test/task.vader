Include: setup.vader

#----------------------------------------------------------------# Generate ID #

Execute (GenerateId):
  let result1 = kronos#task#GenerateId([{'id': 1}, {'id': 2}, {'id': 4}])
  let result2 = kronos#task#GenerateId([{'id': 2}, {'id': 3}, {'id': 5}])
  let result3 = kronos#task#GenerateId([{'id': 1}, {'id': 2}, {'id': 3}])

Then (should generate correct id):
  AssertEqual 3, result1
  AssertEqual 1, result2
  AssertEqual 4, result3

#-------------------------------------------------------# Get task index by ID #

Execute (GetTaskIndexById):
  let result = kronos#task#GetTaskIndexById(g_tasks, 1)

Then (should get task by id):
  AssertEqual 0, result
  AssertThrows kronos#task#GetTaskIndexById(g_tasks, 0)

#----------------------------------------------------------------# Create task #

Execute (Create):
  call kronos#task#Create(g_database, g_task)

Then (should insert a task):
  AssertEqual g_tasks, kronos#database#ReadTasks(g_database)

#------------------------------------------------------------------# Read task #

Execute (Read):
  call kronos#task#Create(g_database, g_task)
  let result = kronos#task#Read(g_database, 1)

Then (should get a task by id):
  AssertEqual g_task, result

#-------------------------------------------------------------# Read all tasks #

Execute (ReadAll):
  call kronos#task#Create(g_database, g_task)
  let result = kronos#task#ReadAll(g_database)

Then (should get all tasks):
  AssertEqual g_tasks, result
  AssertEqual kronos#database#ReadTasks(g_database), result

#----------------------------------------------------------------# Update task #

Execute (Update):
  call kronos#task#Create(g_database, g_task)

  let task_updated = {
    \ 'id': 1,
    \ 'desc': 'test kronos updated',
    \ 'tags': ['test', 'vader', 'kronos', 'update'],
    \ 'due': 1527462654
  \}

  let result = kronos#task#Update(g_database, task_updated)

Then (should update a task):
  Assert result
  AssertEqual [task_updated], kronos#database#ReadTasks(g_database)

#----------------------------------------------------------------# Delete task #

Execute (Delete):
  call kronos#task#Create(g_database, g_task)
  let result = kronos#task#Delete(g_database, 1)

Then (should delete a task by id):
  Assert result
  AssertEqual [], kronos#database#ReadTasks(g_database)

